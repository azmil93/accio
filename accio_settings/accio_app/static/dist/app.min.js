"use strict";angular.module("Accio_app",["angularAudioRecorder","ngRoute"]).config(["$interpolateProvider","$httpProvider","recorderServiceProvider","$sceDelegateProvider",function(t,e,r,n){t.startSymbol("[[").endSymbol("]]"),e.defaults.xsrfCookieName="csrftoken",e.defaults.xsrfHeaderName="X-CSRFToken",r.forceSwf(!1).withMp3Conversion(!1),n.resourceUrlWhitelist(["self","https://p.scdn.co/**"])}]),angular.module("Accio_app").factory("UserFactory",["$http",function(t){var e="http://localhost:8000";return{userAuth:function(){return t.get(e+"/userAuth/").then(function(t){return t.data})}}}]).factory("DataFactory",["$http",function(t){var e="http://localhost:8000";return{registerUser:function(r){return t({url:e+"/register/",method:"POST",data:{first_name:r.first_name,last_name:r.last_name,username:r.username,email:r.email,password:r.password}}).then(function(t){return t.data})},loginUser:function(r){return t({url:e+"/login/",method:"POST",data:{username:r.username,password:r.password}}).then(function(t){return t.data})},logoutUser:function(){return t.get(e+"/logout").then(function(t){return t.data})},getUserTracks:function(){return t.get(e+"/getTracks/").then(function(t){return t.data})},deleteTrack:function(r){return t.delete(e+"/"+r+"/").then(function(t){return t.data})},recognize:function(e){return t({method:"POST",url:"http://localhost:8000/recognize/",data:e}).then(function(t){return t.data})},updateUser:function(r){return t.patch(e+"/update/",{trackId:r}).then(function(t){return t.data})}}}]);var requiresAuth=["$location","UserFactory",function(t,e){return new Promise(function(r,n){e.userAuth().then(function(e){e.user?r():(n(),t.path("/"))})})}];angular.module("Accio_app").config(["$routeProvider",function(t){t.when("/profile",{templateUrl:"static/src/javascripts/profile/profile.html",controller:"ProfileCtrl",controllerAs:"profile",resolve:{requiresAuth:requiresAuth}}).when("/",{templateUrl:"static/src/javascripts/record/record.html",controller:"RecordCtrl",controllerAs:"record"})}]),angular.module("Accio_app").controller("LoginCtrl",["DataFactory","$location","UserFactory","$window",function(t,e,r,n){var o=this;o.hello="Accio",r.userAuth().then(function(t){return o.user=t}),o.loginUser=function(){t.loginUser(o.user).then(function(t){t[0]?n.location.reload():alert("Login Failed")})},o.register=function(){t.registerUser(o.createUser).then(function(t){t[0]?n.location.reload():alert("Login Failed")})},o.logout=function(){t.logoutUser().then(function(t){t.logout===!0&&n.location.reload()})}}]),angular.module("Accio_app").controller("ProfileCtrl",["DataFactory","$location","UserFactory",function(t,e,r){var n=this;r.userAuth().then(function(t){return n.username=t.username}),n.title="welcome",n.getTracks=function(){t.getUserTracks().then(function(t){t.length>=1?n.tracks=t:(n.noTracks=!0,n.response=t.error)})},n.getTracks(),n.record=function(){e.path("/")},n.delete=function(e){t.deleteTrack(e.pk).then(n.getTracks())}}]),angular.module("Accio_app").controller("RecordCtrl",["$interval","$http","DataFactory","$location","$window",function(t,e,r,n,o){var a=this;a.int=t(function(){if(a.recorded){var t=new FormData;t.append("audio/wav",a.recorded,"output.wav"),r.recognize(t).then(function(t){try{1001===t.status.code&&(a.noResults=!0)}catch(e){a.results=t[0],a.showInfo=!0,0===a.results.fields.user&&(a.anonUser=!0)}}),a.showResults=!0,a.stopInterval()}},1e3),a.stopInterval=function(){t.cancel(a.int)},a.register=function(){r.registerUser(a.createUser).then(function(t){r.updateUser(a.results.pk).then(function(t){o.location.reload(),n.path("/profile")})})},a.reload=function(){o.location.reload()}}]);